const translations = {
  "zh-CN": {
    "app_name": "代理助手",
    "settings_title": "代理助手设置",
    "manage_proxies": "管理代理",
    "manage_proxies_desc": "新增、编辑或删除您的代理配置",
    "expand_all": "展开全部",
    "collapse_all": "折叠全部",
    "add_new": "新增",
    "save": "保存",
    "system_config": "系统配置",
    "language_settings": "语言设置",
    "select_language": "选择语言",
    "theme_settings": "主题模式",
    "theme_settings_desc": "选择白天模式、夜间模式或自动切换",
    "theme_light": "白天",
    "theme_dark": "夜间",
    "theme_auto": "自动",
    "auto_mode_time": "夜间模式切换起始时间",
    "auto_mode_time_desc": "设置夜间模式的开始和结束时间",
    "start_time": "开始时间",
    "end_time": "结束时间",
    "sync_settings": "同步设置",
    "auto_sync_desc": "在相同账户 (Google/FireFox) 的浏览器间同步代理数据 (默认开启)",
    "config_management": "配置管理",
    "config_desc": "管理系统配置",
    "export_config": "导出配置",
    "import_config": "导入配置",
    "delete_proxy_title": "删除代理",
    "delete_proxy_confirm": "确定要删除这个代理吗？",
    "cancel": "取消",
    "delete": "删除",
    "save_success": "保存成功",
    "save_failed": "保存失败：",
    "status_label": "状态:",
    "status_disconnected": "未连接",
    "status_disabled": "已禁用",
    "status_enabled": "已启用",
    "mode_disabled": "禁用",
    "mode_manual": "手动",
    "mode_auto": "自动",
    "mode_auto_text": "自动模式",
    "no_proxy_added": "您还没有添加代理",
    "add_proxy_btn": "添加新代理",
    "unnamed_proxy": "未命名代理",
    "drag_sort": "拖动排序",
    "proxy_name": "代理名称",
    "protocol": "协议",
    "fallback_policy": "失败策略 (自动模式)",
    "fallback_reject": "报错",
    "fallback_direct": "直接连接",
    "ip_address": "代理地址",
    "port": "端口",
    "username_optional": "用户名 (可选)",
    "password_optional": "密码 (可选)",
    "proxy_urls_auto": "使用代理的地址 (自动模式)",
    "proxy_urls_placeholder": "每行一个地址，例如：\ngoogle.com\n*.twitter.com",
    "bypass_urls": "不使用代理的地址 (手动模式)",
    "bypass_urls_placeholder": "每行一个地址，例如：\nlocalhost\n127.0.0.1\ninternal.com",
    "alert_name_required": "请为代理设置一个名称。",
    "alert_name_duplicate": "代理名称已存在，请使用不同的名称。",
    "alert_ip_invalid": "请输入有效的代理地址（IP 或域名）。",
    "alert_port_invalid": "请输入有效的端口号 (1-65535)。",
    "alert_ip_required": "代理地址不能为空。",
    "alert_ip_format": "IP地址必须包含四个以点(. )分隔的数字块。",
    "alert_ip_part_empty": "IP地址的部分数字块不能为空。",
    "alert_ip_part_nan": "IP地址的数字块必须为数字。",
    "alert_ip_leading_zero": "IP地址的数字块不能有前导零。",
    "alert_ip_part_range": "IP地址的数字块必须在0-255范围内。",
    "alert_import_success": "导入成功！已更新系统设置与代理列表。请点击\"保存\"以应用更改。",
    "alert_import_legacy": "导入成功！检测到旧版配置格式，已恢复代理列表。请点击\"保存\"以应用更改。",
    "alert_invalid_format": "无效的配置文件格式。",
    "alert_parse_error": "解析文件失败：",
    "alert_sync_enabled": "已开启自动同步。点击\"保存\"按钮可将当前配置同步至您的 Google 账户。",
    "settings_tooltip": "设置",
    "authentication": "认证",
    "link_test": "测试",
    "testing": "测试中...",
    "test_success": "连接正常",
    "test_failed": "连接失败",
    "test_all": "测试",
    "proxy_name_placeholder": "例如：办公室代理",
    "username_placeholder": "用户名",
    "password_placeholder": "密码"
  },
  "zh-TW": {
    "app_name": "代理助手",
    "settings_title": "代理助手設定",
    "manage_proxies": "管理代理",
    "manage_proxies_desc": "新增、編輯或刪除您的代理設定",
    "expand_all": "展開全部",
    "collapse_all": "折疊全部",
    "add_new": "新增",
    "save": "儲存",
    "system_config": "系統配置",
    "language_settings": "語言設定",
    "select_language": "選擇語言",
    "theme_settings": "主題模式",
    "theme_settings_desc": "選擇白天模式、夜間模式或自動切換",
    "theme_light": "白天",
    "theme_dark": "夜間",
    "theme_auto": "自動",
    "auto_mode_time": "夜間模式切換起始時間",
    "auto_mode_time_desc": "設定夜間模式的開始和結束時間",
    "start_time": "開始時間",
    "end_time": "結束時間",
    "sync_settings": "同步設定",
    "auto_sync_desc": "在相同帳戶 (Google/FireFox) 的瀏覽器間同步代理數據 (預設開啟)",
    "config_management": "配置管理",
    "config_desc": "管理系統配置",
    "export_config": "匯出配置",
    "import_config": "匯入配置",
    "delete_proxy_title": "刪除代理",
    "delete_proxy_confirm": "確定要刪除這個代理嗎？",
    "cancel": "取消",
    "delete": "刪除",
    "save_success": "儲存成功",
    "save_failed": "儲存失敗：",
    "status_label": "狀態:",
    "status_disconnected": "未連結",
    "status_disabled": "已停用",
    "status_enabled": "已啟用",
    "mode_disabled": "停用",
    "mode_manual": "手動",
    "mode_auto": "自動",
    "mode_auto_text": "自動模式",
    "no_proxy_added": "您還沒有新增代理",
    "add_proxy_btn": "新增代理",
    "unnamed_proxy": "未命名代理",
    "drag_sort": "拖曳排序",
    "proxy_name": "代理名稱",
    "protocol": "協定",
    "fallback_policy": "失敗策略 (自動模式)",
    "fallback_reject": "報錯",
    "fallback_direct": "直接連接",
    "ip_address": "代理地址",
    "port": "連接埠",
    "username_optional": "使用者名稱 (選填)",
    "password_optional": "密碼 (選填)",
    "proxy_urls_auto": "使用代理的地址 (自動模式)",
    "proxy_urls_placeholder": "每行一個地址，例如：\ngoogle.com\n*.twitter.com",
    "bypass_urls": "不使用代理的地址 (手動模式)",
    "bypass_urls_placeholder": "每行一個地址，例如：\nlocalhost\n127.0.0.1\ninternal.com",
    "alert_name_required": "請為代理設定一個名稱。",
    "alert_name_duplicate": "代理名稱已存在，請使用不同的名稱。",
    "alert_ip_invalid": "請輸入有效的代理地址（IP 或網域名稱）。",
    "alert_port_invalid": "請輸入有效的連接埠號碼 (1-65535)。",
    "alert_ip_required": "代理地址不能為空。",
    "alert_ip_format": "IP地址必須包含四個以點(. )分隔的數字區塊。",
    "alert_ip_part_empty": "IP地址的部分數字區塊不能為空。",
    "alert_ip_part_nan": "IP地址的數字區塊必須為數字。",
    "alert_ip_leading_zero": "IP地址的數字區塊不能有前導零。",
    "alert_ip_part_range": "IP地址的數字區塊必須在0-255範圍內。",
    "alert_import_success": "匯入成功！已更新系統設定與代理列表。請點選「儲存」以套用變更。",
    "alert_import_legacy": "匯入成功！偵測到舊版配置格式，已恢復代理列表。請點選「儲存」以套用變更。",
    "alert_invalid_format": "無效的設定檔格式。",
    "alert_parse_error": "解析檔案失敗：",
    "alert_sync_enabled": "已開啟自動同步。點選「儲存」按鈕可將目前配置同步至您的 Google 帳戶。",
    "settings_tooltip": "設定",
    "authentication": "認證",
    "link_test": "測試",
    "testing": "測試中...",
    "test_success": "連線正常",
    "test_failed": "連線失敗",
    "test_all": "測試",
    "proxy_name_placeholder": "例如：辦公室代理",
    "username_placeholder": "用戶名",
    "password_placeholder": "密碼"
  },
  "en": {
    "app_name": "Proxy Assistant",
    "settings_title": "Proxy Assistant Settings",
    "manage_proxies": "Manage Proxies",
    "manage_proxies_desc": "Add, edit or delete your proxy configurations",
    "expand_all": "Expand All",
    "collapse_all": "Collapse All",
    "add_new": "New",
    "save": "Save",
    "system_config": "System Configuration",
    "language_settings": "Language Settings",
    "select_language": "Select Language",
    "theme_settings": "Theme Mode",
    "theme_settings_desc": "Choose Light, Dark, or Auto mode",
    "theme_light": "Light",
    "theme_dark": "Dark",
    "theme_auto": "Auto",
    "auto_mode_time": "Dark Mode Schedule",
    "auto_mode_time_desc": "Set the start and end time for dark mode",
    "start_time": "Start Time",
    "end_time": "End Time",
    "sync_settings": "Sync Settings",
    "auto_sync_desc": "Sync proxy data across browsers with the same account (Google/FireFox) (Enabled by default)",
    "config_management": "Configuration Management",
    "config_desc": "Manage system configurations",
    "export_config": "Export Config",
    "import_config": "Import Config",
    "delete_proxy_title": "Delete Proxy",
    "delete_proxy_confirm": "Are you sure you want to delete this proxy?",
    "cancel": "Cancel",
    "delete": "Delete",
    "save_success": "Saved Successfully",
    "save_failed": "Save Failed: ",
    "status_label": "Status:",
    "status_disconnected": "Disconnected",
    "status_disabled": "Disabled",
    "status_enabled": "Enabled",
    "mode_disabled": "Disable",
    "mode_manual": "Manual",
    "mode_auto": "Auto",
    "mode_auto_text": "Auto Mode",
    "no_proxy_added": "No proxies added yet",
    "add_proxy_btn": "Add New Proxy",
    "unnamed_proxy": "Unnamed Proxy",
    "drag_sort": "Drag to sort",
    "proxy_name": "Proxy Name",
    "protocol": "Protocol",
    "fallback_policy": "Fallback Policy (Auto Mode)",
    "fallback_reject": "Reject",
    "fallback_direct": "Direct Connect",
    "ip_address": "Proxy Address",
    "port": "Port",
    "username_optional": "Username (Optional)",
    "password_optional": "Password (Optional)",
    "proxy_urls_auto": "Addresses using proxy (Auto Mode)",
    "proxy_urls_placeholder": "One address per line, e.g.:\ngoogle.com\n*.twitter.com",
    "bypass_urls": "Addresses bypassing proxy (Manual Mode)",
    "bypass_urls_placeholder": "One address per line, e.g.:\nlocalhost\n127.0.0.1\ninternal.com",
    "alert_name_required": "Please set a name for the proxy.",
    "alert_name_duplicate": "Proxy name already exists, please use a different name.",
    "alert_ip_invalid": "Please enter a valid proxy address (IP or domain).",
    "alert_port_invalid": "Please enter a valid port number (1-65535).",
    "alert_ip_required": "Proxy address cannot be empty.",
    "alert_ip_format": "IP address must contain four dot-separated blocks.",
    "alert_ip_part_empty": "IP address parts cannot be empty.",
    "alert_ip_part_nan": "IP address parts must be numbers.",
    "alert_ip_leading_zero": "IP address parts cannot have leading zeros.",
    "alert_ip_part_range": "IP address parts must be between 0 and 255.",
    "alert_import_success": "Import successful! System settings and proxy list updated. Please click 'Save' to apply changes.",
    "alert_import_legacy": "Import successful! Legacy format detected, proxy list restored. Please click 'Save' to apply changes.",
    "alert_invalid_format": "Invalid configuration file format.",
    "alert_parse_error": "Failed to parse file: ",
    "alert_sync_enabled": "Auto sync enabled. Click 'Save' to sync current configuration to your Google account.",
    "settings_tooltip": "Settings",
    "authentication": "Auth",
    "link_test": "Test",
    "testing": "Testing...",
    "test_success": "Connected",
    "test_failed": "Failed",
    "test_all": "Test",
    "proxy_name_placeholder": "e.g., Office Proxy",
    "username_placeholder": "Username",
    "password_placeholder": "Password"
  },
  "ja": {
    "app_name": "プロキシアシスタント",
    "settings_title": "プロキシアシスタント設定",
    "manage_proxies": "プロキシ管理",
    "manage_proxies_desc": "プロキシ設定の追加、編集、削除",
    "expand_all": "展開",
    "collapse_all": "折り畳み",
    "add_new": "新規",
    "save": "保存",
    "system_config": "システム設定",
    "language_settings": "言語設定",
    "select_language": "言語を選択",
    "theme_settings": "テーマモード",
    "theme_settings_desc": "ライト、ダーク、または自動モードを選択",
    "theme_light": "ライト",
    "theme_dark": "ダーク",
    "theme_auto": "自動",
    "auto_mode_time": "ダークモード切替時刻",
    "auto_mode_time_desc": "ダークモードの開始時刻と終了時刻を設定",
    "start_time": "開始時間",
    "end_time": "終了時間",
    "sync_settings": "同期設定",
    "auto_sync_desc": "同じアカウント (Google/FireFox) のブラウザ間でプロキシデータを同期します（デフォルトで有効）",
    "config_management": "設定管理",
    "config_desc": "システム設定を管理する",
    "export_config": "設定をエクスポート",
    "import_config": "設定をインポート",
    "delete_proxy_title": "プロキシを削除",
    "delete_proxy_confirm": "このプロキシを削除してもよろしいですか？",
    "cancel": "キャンセル",
    "delete": "削除",
    "save_success": "保存しました",
    "save_failed": "保存に失敗しました：",
    "status_label": "ステータス:",
    "status_disconnected": "未接続",
    "status_disabled": "無効",
    "status_enabled": "有効",
    "mode_disabled": "無効",
    "mode_manual": "手動",
    "mode_auto": "自動",
    "mode_auto_text": "自動モード",
    "no_proxy_added": "プロキシが追加されていません",
    "add_proxy_btn": "新しいプロキシを追加",
    "unnamed_proxy": "名称未設定プロキシ",
    "drag_sort": "ドラッグして並べ替え",
    "proxy_name": "プロキシ名",
    "protocol": "プロトコル",
    "fallback_policy": "フォールバックポリシー（自動モード）",
    "fallback_reject": "エラー",
    "fallback_direct": "直接接続",
    "ip_address": "プロキシアドレス",
    "port": "ポート",
    "username_optional": "ユーザー名 (任意)",
    "password_optional": "パスワード (任意)",
    "proxy_urls_auto": "プロキシを使用するアドレス（自動モード）",
    "proxy_urls_placeholder": "1行に1つのアドレス、例：\ngoogle.com\n*.twitter.com",
    "bypass_urls": "プロキシを使用しないアドレス（手動モード）",
    "bypass_urls_placeholder": "1行に1つのアドレス、例：\nlocalhost\n127.0.0.1\ninternal.com",
    "alert_name_required": "プロキシの名前を設定してください。",
    "alert_name_duplicate": "プロキシ名が既に存在します。別の名前を使用してください。",
    "alert_ip_invalid": "有効なプロキシアドレス (IP またはドメイン) を入力してください。",
    "alert_port_invalid": "有効なポート番号 (1-65535) を入力してください。",
    "alert_ip_required": "プロキシアドレスを入力してください。",
    "alert_ip_format": "IPアドレスはドット(.)で区切られた4つのブロックである必要があります。",
    "alert_ip_part_empty": "IPアドレスの一部が空です。",
    "alert_ip_part_nan": "IPアドレスの各部分は数字である必要があります。",
    "alert_ip_leading_zero": "IPアドレスの各部分に先行ゼロを含めることはできません。",
    "alert_ip_part_range": "IPアドレスの各部分は0〜255の範囲内である必要があります。",
    "alert_import_success": "インポート成功！システム設定とプロキシリストを更新しました。変更を適用するには「保存」をクリックしてください。",
    "alert_import_legacy": "インポート成功！旧形式を検出しました。プロキシリストを復元しました。変更を適用するには「保存」をクリックしてください。",
    "alert_invalid_format": "無効な設定ファイル形式です。",
    "alert_parse_error": "ファイルの解析に失敗しました：",
    "alert_sync_enabled": "自動同期が有効になりました。「保存」ボタンをクリックして、現在の設定をGoogleアカウントに同期してください。",
    "settings_tooltip": "設定",
    "authentication": "認証",
    "link_test": "テスト",
    "testing": "テスト中...",
    "test_success": "接続成功",
    "test_failed": "接続失敗",
    "test_all": "テスト",
    "proxy_name_placeholder": "例：会社のプロキシ",
    "username_placeholder": "ユーザー名",
    "password_placeholder": "パスワード"
  },
  "fr": {
    "app_name": "Assistant Proxy",
    "settings_title": "Paramètres de l'Assistant Proxy",
    "manage_proxies": "Gérer les Proxys",
    "manage_proxies_desc": "Ajouter, modifier ou supprimer des configurations de proxy",
    "expand_all": "Développer",
    "collapse_all": "Réduire",
    "add_new": "Nouveau",
    "save": "Enregistrer",
    "system_config": "Configuration Système",
    "language_settings": "Paramètres de Langue",
    "select_language": "Choisir la Langue",
    "theme_settings": "Mode Thème",
    "theme_settings_desc": "Choisir le mode Clair, Sombre ou Auto",
    "theme_light": "Clair",
    "theme_dark": "Sombre",
    "theme_auto": "Auto",
    "auto_mode_time": "Planification Mode Sombre",
    "auto_mode_time_desc": "Définir l'heure de début et de fin du mode sombre",
    "start_time": "Heure de début",
    "end_time": "Heure de fin",
    "sync_settings": "Paramètres de Synchro",
    "auto_sync_desc": "Synchroniser les données proxy entre les navigateurs avec le même compte (Google/FireFox) (Activé par défaut)",
    "config_management": "Gestion de la Configuration",
    "config_desc": "Gérer les configurations système",
    "export_config": "Exporter Config",
    "import_config": "Importer Config",
    "delete_proxy_title": "Supprimer Proxy",
    "delete_proxy_confirm": "Êtes-vous sûr de vouloir supprimer ce proxy ?",
    "cancel": "Annuler",
    "delete": "Supprimer",
    "save_success": "Enregistré avec succès",
    "save_failed": "Échec de l'enregistrement : ",
    "status_label": "État :",
    "status_disconnected": "Déconnecté",
    "status_disabled": "Désactivé",
    "status_enabled": "Activé",
    "mode_disabled": "Désactivé",
    "mode_manual": "Manuel",
    "mode_auto": "Auto",
    "mode_auto_text": "Mode Auto",
    "no_proxy_added": "Aucun proxy ajouté",
    "add_proxy_btn": "Ajouter Nouveau Proxy",
    "unnamed_proxy": "Proxy Sans Nom",
    "drag_sort": "Glisser pour trier",
    "proxy_name": "Nom du Proxy",
    "protocol": "Protocole",
    "fallback_policy": "Stratégie de repli (Mode Auto)",
    "fallback_reject": "Rejeter",
    "fallback_direct": "Connexion directe",
    "ip_address": "Adresse du proxy",
    "port": "Port",
    "username_optional": "Nom d'utilisateur (Optionnel)",
    "password_optional": "Mot de passe (Optionnel)",
    "proxy_urls_auto": "Adresses utilisant le proxy (Mode Auto)",
    "proxy_urls_placeholder": "Une adresse par ligne, ex :\ngoogle.com\n*.twitter.com",
    "bypass_urls": "Adresses ignorant le proxy (Mode Manuel)",
    "bypass_urls_placeholder": "Une adresse par ligne, ex :\nlocalhost\n127.0.0.1\ninternal.com",
    "alert_name_required": "Veuillez définir un nom pour le proxy.",
    "alert_name_duplicate": "Le nom du proxy existe déjà, veuillez en utiliser un autre.",
    "alert_ip_invalid": "Veuillez entrer une adresse de proxy valide (IP ou domaine).",
    "alert_port_invalid": "Veuillez entrer un numéro de port valide (1-65535).",
    "alert_ip_required": "L'adresse du proxy ne peut pas être vide.",
    "alert_ip_format": "L'adresse IP doit contenir quatre blocs séparés par des points.",
    "alert_ip_part_empty": "Les parties de l'adresse IP ne peuvent pas être vides.",
    "alert_ip_part_nan": "Les parties de l'adresse IP doivent être des nombres.",
    "alert_ip_leading_zero": "Les parties de l'adresse IP ne peuvent pas avoir de zéros non significatifs.",
    "alert_ip_part_range": "Les parties de l'adresse IP doivent être comprises entre 0 et 255.",
    "alert_import_success": "Importation réussie ! Paramètres système et liste des proxys mis à jour. Veuillez cliquer sur 'Enregistrer' pour appliquer les changements.",
    "alert_import_legacy": "Importation réussie ! Format hérité détecté, liste des proxys restaurée. Veuillez cliquer sur 'Enregistrer' pour appliquer les changements.",
    "alert_invalid_format": "Format de fichier de configuration invalide.",
    "alert_parse_error": "Échec de l'analyse du fichier : ",
    "alert_sync_enabled": "Synchro auto activée. Cliquez sur 'Enregistrer' pour synchroniser la configuration actuelle avec votre compte Google.",
    "settings_tooltip": "Paramètres",
    "authentication": "Auth",
    "link_test": "Tester",
    "testing": "Test en cours...",
    "test_success": "Connecté",
    "test_failed": "Échoué",
    "test_all": "Tester",
    "proxy_name_placeholder": "Ex : Proxy de bureau",
    "username_placeholder": "Nom d'utilisateur",
    "password_placeholder": "Mot de passe"
  }
};

let currentLang = 'zh-CN'; // Default language

const I18n = {
  init: function (callback) {
    chrome.storage.local.get(['appLanguage'], function (result) {
      if (result.appLanguage) {
        currentLang = result.appLanguage;
      } else {
        currentLang = 'zh-CN';
        chrome.storage.local.set({ appLanguage: 'zh-CN' });
      }
      I18n.updatePage();
      if (callback) callback();
    });
  },

  setLanguage: function (lang) {
    if (translations[lang]) {
      currentLang = lang;
      chrome.storage.local.set({ appLanguage: lang });
      I18n.updatePage();
    }
  },

  t: function (key) {
    return translations[currentLang][key] || key;
  },

  updatePage: function () {
    $('[data-i18n]').each(function () {
      const key = $(this).data('i18n');
      const translation = I18n.t(key);
      if ($(this).is('input, textarea')) {
        // Do not overwrite dynamic values in inputs/textareas
      } else if ($(this).children().length === 0) {
        $(this).text(translation);
      } else {
        // Find and update ONLY the first direct text node child
        const nodes = $(this).contents();
        let found = false;
        for (let i = 0; i < nodes.length; i++) {
          if (nodes[i].nodeType === 3 && nodes[i].nodeValue.trim().length > 0) {
            nodes[i].nodeValue = translation;
            found = true;
            break;
          }
        }
        // If no non-empty text node found, but element is not empty, 
        // we might need to handle it differently, but for now we stay safe.
      }
    });

    $('[data-i18n-placeholder]').each(function () {
      const key = $(this).data('i18n-placeholder');
      $(this).attr('placeholder', I18n.t(key));
    });

    $('[data-i18n-title]').each(function () {
      const key = $(this).data('i18n-title');
      $(this).attr('title', I18n.t(key));
    });

    if ($('title[data-i18n]').length) {
      $('title[data-i18n]').text(I18n.t($('title[data-i18n]').data('i18n')));
    }
  },

  getCurrentLanguage: function () {
    return currentLang;
  }
};

window.I18n = I18n;
